<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ska Digital Hub CRM</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:#f5f5f5;}
.container{max-width:1200px;}
.nav-link.active{background:black !important;color:white!important}
</style>
</head>

<body>
<nav class="nav nav-pills m-3">
<a class="nav-link active" onclick="show('clients')">Clients</a>
<a class="nav-link" onclick="show('projects')">Projects</a>
<a class="nav-link" onclick="show('payments')">Payments</a>
<a class="nav-link" onclick="show('todos')">Todos</a>
<a class="nav-link" onclick="show('tracking')">Tracking</a>
<a class="nav-link" onclick="show('email')">Email</a>
</nav>

<div class="container">
<!-- ✅ CLIENTS -->
<div id="clients" class="screen">
<h3>Clients</h3>
<input id="clientId" type="hidden">
<input class="form-control mb-2" id="clientName" placeholder="Name">
<input class="form-control mb-2" id="clientCompany" placeholder="Company">
<input class="form-control mb-2" id="clientContact" placeholder="Contact">
<input class="form-control mb-2" id="clientEmail" placeholder="Email">
<input class="form-control mb-2" id="clientProduct" placeholder="Product">
<select class="form-control mb-2" id="clientStatus">
<option>scout</option><option>contacted</option><option>interested</option>
<option>negotiation</option><option>hold</option><option>closed</option>
</select>
<button class="btn btn-primary mb-3" onclick="saveClient()">Save</button>
<table class="table table-striped" id="clientTable"><tbody></tbody></table>
</div>

<!-- ✅ PROJECTS -->
<div id="projects" class="screen" style="display:none">
<h3>Projects</h3>
<input id="projectId" type="hidden">
<input class="form-control mb-2" id="projectName" placeholder="Project Name">
<input class="form-control mb-2" id="projectClientId" placeholder="Client ID">
<input class="form-control mb-2" id="projectDesc" placeholder="Description">
<input type="date" class="form-control mb-2" id="projectStart">
<input type="date" class="form-control mb-2" id="projectEnd">
<input class="form-control mb-2" id="projectStatus" placeholder="Status">
<input class="form-control mb-2" id="projectCharged" placeholder="Total Charged">
<button class="btn btn-primary mb-3" onclick="saveProject()">Save</button>
<table class="table table-striped" id="projectTable"><tbody></tbody></table>
</div>

<!-- ✅ PAYMENTS -->
<div id="payments" class="screen" style="display:none">
<h3>Payments</h3>
<input id="paymentId" type="hidden">
<input class="form-control mb-2" id="paymentProjectId" placeholder="Project ID">
<input class="form-control mb-2" id="paymentAmount" placeholder="Amount">
<input type="date" class="form-control mb-2" id="paymentDate">
<select class="form-control mb-2" id="paymentStatus"><option>Pending</option><option>Paid</option></select>
<button class="btn btn-primary mb-3" onclick="savePayment()">Save</button>
<table class="table table-striped" id="paymentTable"><tbody></tbody></table>
</div>

<!-- ✅ TODOS -->
<div id="todos" class="screen" style="display:none">
<h3>Todo</h3>
<input id="todoId" type="hidden">
<input class="form-control mb-2" id="todoTask" placeholder="Task">
<input type="date" class="form-control mb-2" id="todoDue">
<label><input type="checkbox" id="todoDone"> Done</label>
<button class="btn btn-primary mb-3" onclick="saveTodo()">Save</button>
<table class="table table-striped" id="todoTable"><tbody></tbody></table>
</div>

<!-- ✅ TRACKING -->
<div id="tracking" class="screen" style="display:none">
<h3>Project Tracking</h3>
<input id="trackId" type="hidden">
<input class="form-control mb-2" id="trackProjectId" placeholder="Project ID">
<input class="form-control mb-2" id="trackStage" placeholder="Stage">
<input class="form-control mb-2" id="trackNotes" placeholder="Notes">
<button class="btn btn-primary mb-3" onclick="saveTrack()">Save</button>
<table class="table table-striped" id="trackTable"><tbody></tbody></table>
</div>

<!-- ✅ EMAIL -->
<div id="email" class="screen" style="display:none">
<h3>Send Email</h3>
<input class="form-control mb-2" id="emailTo" placeholder="To">
<input class="form-control mb-2" id="emailSubject" placeholder="Subject">
<textarea class="form-control mb-2" id="emailBody" placeholder="Message"></textarea>
<button class="btn btn-success" onclick="sendMail()">Send</button>
</div>
</div>

<div style="background: blue; color: white">
  <a href="index.html">Back</a>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbxOJQSRAXcVsHWoUQHlQYVLSt202_UNFtJ3KUkgeE165eBzw_LDVN3WumibZqI5e7_OSw/exec";

/* Switch screen */
function show(id){
document.querySelectorAll(".screen").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
load(id);
}

/* Read */
async function get(sheet){
return await (await fetch(`${API}?action=read&sheet=${sheet}`)).json();
}

/* Render tables */
async function load(t){
const map={clients:"Clients",projects:"Projects",payments:"Payments",todos:"Todos",tracking:"ProjectTracking"};
let sheet=map[t]; if(!sheet) return;
let data=await get(sheet);
let tbody=document.querySelector(`#${t}Table tbody`);
tbody.innerHTML="";
data.forEach(r=>{
tbody.innerHTML+=`<tr>${r.map(v=>`<td>${v}</td>`).join("")}</tr>`;
});
}

/********* SAVE FUNCTIONS *********/
async function saveClient(){
const data=[clientName.value,clientCompany.value,clientContact.value,clientEmail.value,clientProduct.value,clientStatus.value];
await fetch(`${API}?action=create&sheet=Clients`,{method:"POST",body:JSON.stringify({data})});
show('clients');
}

async function saveProject(){
const data=[projectName.value,projectClientId.value,projectDesc.value,projectStart.value,projectEnd.value,projectStatus.value,projectCharged.value];
await fetch(`${API}?action=create&sheet=Projects`,{method:"POST",body:JSON.stringify({data})});
show('projects');
}

async function savePayment(){
const data=[paymentProjectId.value,paymentAmount.value,paymentDate.value,paymentStatus.value];
await fetch(`${API}?action=create&sheet=Payments`,{method:"POST",body:JSON.stringify({data})});
show('payments');
}

async function saveTodo(){
const data=[todoTask.value,todoDue.value,todoDone.checked];
await fetch(`${API}?action=create&sheet=Todos`,{method:"POST",body:JSON.stringify({data})});
show('todos');
}

async function saveTrack(){
const data=[trackProjectId.value,trackStage.value,trackNotes.value];
await fetch(`${API}?action=create&sheet=ProjectTracking`,{method:"POST",body:JSON.stringify({data})});
show('tracking');
}

/******** EMAIL ********/
async function sendMail(){
await fetch(`${API}?action=sendEmail`,{method:"POST",
body:JSON.stringify({to:emailTo.value,subject:emailSubject.value,body:emailBody.value})
});
alert("✅ Email sent!");
}
</script>
</body>
</html>
